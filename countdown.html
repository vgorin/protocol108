<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Protocol108: Countdown</title>
	<style type="text/css">
		body {
			font-family: monospace;
		}
	</style>
</head>
<body>
<table>
	<tr><td>protocol address:</td><td id="address">N/A</td></tr>
	<tr><td>protocol version:</td><td id="version">N/A</td></tr>
	<tr><td>protocol state:</td><td id="state">N/A</td></tr>
	<tr><td>countdown value:</td><td id="countdown">N/A</td></tr>
	<tr><td>last executor:</td><td id="executor">N/A</td></tr>
	<tr><td>current reward:</td><td id="reward">N/A</td></tr>
	<tr><td>protocol volume:</td><td id="volume">N/A</td></tr>
</table>
</body>
<script type="text/javascript">
	const protocol108Address = "0x177e37b1889B7D235F18d6db7cE70F3d56F3afa8";
	const protocol108abi = [
		{
			"constant": true,
			"inputs": [],
			"name": "version",
			"outputs": [
				{
					"name": "",
					"type": "uint256"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		},
		{
			"constant": true,
			"inputs": [],
			"name": "cycle",
			"outputs": [
				{
					"name": "",
					"type": "uint256"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		},
		{
			"constant": true,
			"inputs": [],
			"name": "executor",
			"outputs": [
				{
					"name": "",
					"type": "address"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		},
		{
			"constant": true,
			"inputs": [],
			"name": "volume",
			"outputs": [
				{
					"name": "",
					"type": "uint256"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		},
		{
			"constant": true,
			"inputs": [],
			"name": "countdown",
			"outputs": [
				{
					"name": "",
					"type": "uint256"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
		}
	];

	const version = document.getElementById("version");
	const state = document.getElementById("state");
	const countdown = document.getElementById("countdown");
	const executor = document.getElementById("executor");
	const reward = document.getElementById("reward");
	const volume = document.getElementById("volume");

	if (typeof web3 !== 'undefined') {
		const protocol108 = web3.eth.contract(protocol108abi).at(protocol108Address);

		address.innerHTML = protocol108Address;

		protocol108.version(function(error, result) {
			version.innerText = result.toNumber();
		});

		protocol108.countdown(function(error, result) {
			const countdownValue = result.toNumber();

			var countdownMinutes = countdownValue / 60 | 0;
			var countdownSeconds = countdownValue % 60;

			countdownMinutes = pad(countdownMinutes, 2);
			countdownSeconds = pad(countdownSeconds, 2);

			if(countdownValue > 0) {
				countdown.innerHTML = countdownMinutes + ":" + countdownSeconds;
			}
			else {
				countdown.innerHTML = "𓋴𓏲𓍒:𓄿𓏱";
			}

			protocol108.cycle(function(error, result) {
				const cycleValue = result.toNumber();
				state.innerHTML = cycleValue > 0? countdownValue > 0? "ACTIVE": "TERMINATED" : "INACTIVE"
			});
		});

		protocol108.executor(function(error, result) {
			executor.innerText = result.toString();
		});

		web3.eth.getBalance(protocol108Address, function(error, result) {
			reward.innerHTML = web3.fromWei(result.toNumber(), "ether") + " ETH";
		});

		protocol108.volume(function(error, result) {
			volume.innerHTML = web3.fromWei(result.toNumber(), "ether") + " ETH";
		});
	}
	else {
		// not a web3 browser

	}

	function pad(num, size) {
		var s = num + "";
		while (s.length < size) {
			s = "0" + s;
		}
		return s;
	}
</script>
</html>
